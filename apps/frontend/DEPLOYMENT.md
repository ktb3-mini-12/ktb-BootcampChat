# Frontend ë°°í¬ ê°€ì´ë“œ

## ğŸš€ ìƒˆë¡œìš´ ë°°í¬ ì›Œí¬í”Œë¡œìš°

### ê°œìš”
ë¡œì»¬ì—ì„œ ë¹Œë“œí•œ ê²°ê³¼ë¬¼ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ê³ , ì„œë²„ì—ì„œëŠ” ì¬ì‹œì‘ë§Œ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°°í¬í•©ë‹ˆë‹¤.

### ì¥ì 
- âœ… ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ˆì•½ (ë¹Œë“œë¥¼ ë¡œì»¬ì—ì„œ ìˆ˜í–‰)
- âœ… ë¹ ë¥¸ ë°°í¬ (ì„œë²„ì—ì„œ ë¹Œë“œ ì‹œê°„ ì œê±°)
- âœ… ì„œë²„ì— ì „ì²´ node_modules ë¶ˆí•„ìš”
- âœ… ë¡¤ë°± ìš©ì´ (ë¹Œë“œ ê²°ê³¼ë¬¼ ë³´ê´€ ê°€ëŠ¥)

---

## ğŸ“‹ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 1. ë¡œì»¬ì—ì„œ ë°°í¬ ì‹¤í–‰
```bash
cd apps/frontend
make deploy
```

### 2. ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ì‘ì—…

#### ë¡œì»¬ (ë¹Œë“œ ë‹¨ê³„)
1. `npm run build:production` ì‹¤í–‰
   - Next.js ë¹Œë“œ ìˆ˜í–‰
   - static íŒŒì¼ì„ standalone ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬
   - public íŒŒì¼ì„ standalone ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬

#### ì„œë²„ë¡œ ì „ì†¡ (ë°°í¬ ë‹¨ê³„)
2. ë¹Œë“œ ê²°ê³¼ë¬¼ë§Œ ì„œë²„ë¡œ ì „ì†¡
   - `.next/standalone/` â†’ ì„œë²„ì˜ ë°°í¬ ë””ë ‰í† ë¦¬
   - `.next/static` â†’ ì„œë²„ì˜ `.next/static`
   - `public` â†’ ì„œë²„ì˜ `public`
   - `restart.sh` â†’ ì„œë²„ì˜ `restart.sh`

#### ì„œë²„ (ì¬ì‹œì‘ ë‹¨ê³„)
3. ì„œë²„ì—ì„œ `restart.sh` ì‹¤í–‰
   - ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
   - ìƒˆë¡œìš´ standalone ì„œë²„ ì‹œì‘
   - ì„œë²„ ì‹œì‘ í™•ì¸

---

## ğŸ”§ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´

### ë¡œì»¬ ë¹Œë“œë§Œ ìˆ˜í–‰
```bash
make build-local
```

### ì „ì²´ ë°°í¬ (ë¹Œë“œ + ì „ì†¡ + ì¬ì‹œì‘)
```bash
make deploy
```

### íŠ¹ì • ì„œë²„ì—ë§Œ ë°°í¬
```bash
DEPLOY_SERVERS="ktb-fe01 ktb-fe02" make deploy
```

### ë°°í¬ ê²½ë¡œ ë³€ê²½
```bash
DEPLOY_PATH=/custom/path make deploy
```

---

## ğŸ“ ë°°í¬ë˜ëŠ” íŒŒì¼ êµ¬ì¡°

ì„œë²„ì— ë°°í¬ë˜ëŠ” ë””ë ‰í† ë¦¬ êµ¬ì¡°:
```
/home/ubuntu/ktb-chat-frontend/
â”œâ”€â”€ .next/
â”‚   â”œâ”€â”€ static/          # ì •ì  ë¦¬ì†ŒìŠ¤ (CSS, JS ë“±)
â”‚   â””â”€â”€ standalone/
â”‚       â””â”€â”€ server.js    # Next.js standalone ì„œë²„
â”œâ”€â”€ public/              # ê³µê°œ ì •ì  íŒŒì¼
â”œâ”€â”€ node_modules/        # ìµœì†Œí•œì˜ ëŸ°íƒ€ì„ dependencies (standaloneì— í¬í•¨)
â”œâ”€â”€ package.json         # íŒ¨í‚¤ì§€ ì •ë³´
â”œâ”€â”€ restart.sh           # ì„œë²„ ì¬ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ app.log              # ì„œë²„ ë¡œê·¸

```

---

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë°°í¬ ì‹¤íŒ¨ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸
1. SSH ì ‘ì† í™•ì¸
   ```bash
   ssh ktb-fe01 "echo 'Connection OK'"
   ```

2. ì„œë²„ ë””ìŠ¤í¬ ê³µê°„ í™•ì¸
   ```bash
   ssh ktb-fe01 "df -h"
   ```

3. ì„œë²„ ë¡œê·¸ í™•ì¸
   ```bash
   ssh ktb-fe01 "cd /home/ubuntu/ktb-chat-frontend && tail -100 app.log"
   ```

### ì„œë²„ì—ì„œ ìˆ˜ë™ ì¬ì‹œì‘
```bash
ssh ktb-fe01
cd /home/ubuntu/ktb-chat-frontend
./restart.sh
```

### ì„œë²„ ìƒíƒœ í™•ì¸
```bash
ssh ktb-fe01 "ps aux | grep 'node .next/standalone/server.js'"
```

---

## ğŸ“ ê´€ë ¨ íŒŒì¼

- `package.json`: ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ ì •ì˜
- `Makefile`: ë°°í¬ ìë™í™” ìŠ¤í¬ë¦½íŠ¸
- `restart.sh`: ì„œë²„ ì¬ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
- `next.config.js`: Next.js standalone ì¶œë ¥ ì„¤ì •
